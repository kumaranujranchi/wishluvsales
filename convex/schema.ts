import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  profiles: defineTable({
    supabase_id: v.optional(v.string()), // store the old id for migration mapping
    employee_id: v.string(),
    full_name: v.string(),
    email: v.string(),
    phone: v.optional(v.string()),
    role: v.string(),
    department_id: v.optional(v.string()),
    reporting_manager_id: v.optional(v.string()),
    image_url: v.optional(v.string()),
    dob: v.optional(v.string()),
    marriage_anniversary: v.optional(v.string()),
    joining_date: v.optional(v.string()),
    is_active: v.boolean(),
    force_password_change: v.boolean(),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_email", ["email"]).index("by_employee_id", ["employee_id"]).index("by_supabase_id", ["supabase_id"]),

  departments: defineTable({
    supabase_id: v.optional(v.string()),
    name: v.string(),
    description: v.optional(v.string()),
    is_active: v.boolean(),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  projects: defineTable({
    supabase_id: v.optional(v.string()),
    name: v.string(),
    address: v.optional(v.string()),
    location_lat: v.optional(v.number()),
    location_lng: v.optional(v.number()),
    google_maps_url: v.optional(v.string()),
    site_photos: v.array(v.string()),
    metadata: v.any(),
    is_active: v.boolean(),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  announcements: defineTable({
    supabase_id: v.optional(v.string()),
    title: v.string(),
    content: v.string(),
    is_important: v.boolean(),
    is_published: v.boolean(),
    created_by: v.optional(v.string()),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  targets: defineTable({
    supabase_id: v.optional(v.string()),
    user_id: v.string(),
    period_type: v.string(),
    target_sqft: v.number(),
    target_amount: v.number(),
    target_units: v.number(),
    start_date: v.string(),
    end_date: v.string(),
    created_by: v.optional(v.string()),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  customers: defineTable({
    supabase_id: v.optional(v.string()),
    name: v.string(),
    email: v.optional(v.string()),
    phone: v.string(),
    alternate_phone: v.optional(v.string()),
    address: v.optional(v.string()),
    metadata: v.any(),
    created_by: v.optional(v.string()),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  site_visits: defineTable({
    supabase_id: v.optional(v.string()),
    requested_by: v.string(),
    customer_name: v.string(),
    customer_phone: v.string(),
    pickup_location: v.optional(v.string()),
    project_ids: v.array(v.string()),
    visit_date: v.string(),
    visit_time: v.string(),
    status: v.string(),
    assigned_vehicle: v.optional(v.string()),
    driver_id: v.optional(v.string()),
    approved_by: v.optional(v.string()),
    approved_at: v.optional(v.string()),
    is_public: v.boolean(),
    notes: v.optional(v.string()),
    rejection_reason: v.optional(v.string()),
    clarification_note: v.optional(v.string()),
    start_odometer: v.optional(v.number()),
    end_odometer: v.optional(v.number()),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  notifications: defineTable({
    supabase_id: v.optional(v.string()),
    user_id: v.string(),
    title: v.string(),
    message: v.string(),
    type: v.string(),
    related_entity_type: v.optional(v.string()),
    related_entity_id: v.optional(v.string()),
    is_read: v.boolean(),
    created_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  sales: defineTable({
    supabase_id: v.optional(v.string()),
    sale_number: v.string(),
    customer_id: v.string(),
    project_id: v.string(),
    sales_executive_id: v.string(),
    team_leader_id: v.optional(v.string()),
    sale_date: v.string(),
    property_type: v.optional(v.string()),
    unit_number: v.optional(v.string()),
    area_sqft: v.optional(v.number()),
    rate_per_sqft: v.optional(v.number()),
    base_price: v.optional(v.number()),
    additional_charges: v.number(),
    discount: v.number(),
    plc: v.number(),
    dev_charges: v.number(),
    is_agreement_done: v.boolean(),
    agreement_date: v.optional(v.string()),
    is_registry_done: v.boolean(),
    registry_date: v.optional(v.string()),
    total_revenue: v.number(),
    booking_amount: v.number(),
    registry_status: v.optional(v.string()),
    possession_date: v.optional(v.string()),
    legal_status: v.optional(v.string()),
    payment_plan: v.optional(v.string()),
    notes: v.optional(v.string()),
    metadata: v.any(),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  payments: defineTable({
    supabase_id: v.optional(v.string()),
    sale_id: v.string(),
    payment_date: v.string(),
    amount: v.number(),
    payment_type: v.string(),
    payment_mode: v.string(),
    transaction_reference: v.optional(v.string()),
    remarks: v.optional(v.string()),
    recorded_by: v.optional(v.string()),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  incentives: defineTable({
    supabase_id: v.optional(v.string()),
    sale_id: v.string(),
    sales_executive_id: v.string(),
    calculation_month: v.string(),
    calculation_year: v.number(),
    total_incentive_amount: v.number(),
    installment_1_amount: v.number(),
    installment_1_paid: v.boolean(),
    installment_1_date: v.optional(v.string()),
    installment_2_amount: v.number(),
    installment_2_paid: v.boolean(),
    installment_2_date: v.optional(v.string()),
    installment_3_amount: v.number(),
    installment_3_paid: v.boolean(),
    installment_3_date: v.optional(v.string()),
    installment_4_amount: v.number(),
    installment_4_paid: v.boolean(),
    installment_4_date: v.optional(v.string()),
    is_locked: v.boolean(),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  reports: defineTable({
    supabase_id: v.optional(v.string()),
    report_name: v.string(),
    report_type: v.string(),
    description: v.optional(v.string()),
    allowed_roles: v.array(v.string()),
    is_downloadable: v.boolean(),
    created_at: v.string(),
    updated_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),

  activity_logs: defineTable({
    supabase_id: v.optional(v.string()),
    user_id: v.optional(v.string()),
    action: v.string(),
    entity_type: v.optional(v.string()),
    entity_id: v.optional(v.string()),
    details: v.any(),
    created_at: v.string(),
  }).index("by_supabase_id", ["supabase_id"]),
});
